# SQM-Link

## Начало работы

Для работы с проектом требутся установленный [Node.js](https://nodejs.org/en/download/) и [Yarn](https://classic.yarnpkg.com/lang/en/docs/install/)

__Установка зависимостей__

```sh
yarn
```


__Сборка проекта__

```sh
yarn build:all
```

Результат сборки помещается в каталог `build`

Подробнее о возможных вариантах сборки в разделе [процесс-сборки](#процесс-сборки)


__Запуск сервера для разработки__

```sh
yarn serve
```



## Файловая структура проекта

### Корень

__`readme.md`__

Ты читаешь его прямо сейчас


__`package.json`__

Основная информация о проекте, список зависимостей


__`yarn.lock`__

__Не удалять, не редактировать__

Сведения обо всех транзитивных зависимостях, включая версии пакетов, с которыми проект гарантированно собирается


__`.gitignore`__

Указывает, какие файлы не должны отслеживаться [Git](https://git-scm.com/)


__`build.js`__

> Предложения по замене этого непотребства приветствуются

Велосипед-таскраннер с интерфейсом командной строки для запуска [webpack](https://webpack.js.org/) при [сборке](#процесс-сборки) нескольких версий проекта под разные МРФ


__`branches.js`__

Список доступных МРФ, под которые производится сборка


__`webpack.config.js`__

Конфигурация [webpack](https://webpack.js.org/) для сборки проекта под МРФ, переданный через параметр [`--env`](https://webpack.js.org/api/cli/#environment-options)

Содержит:
- [пути разрешения импортов](https://webpack.js.org/configuration/resolve/)
- [правила обработки](https://webpack.js.org/configuration/module/#modulerules) попадающих в сборку файлов
- конфигурацию [сервера для разработки](https://webpack.js.org/configuration/dev-server/)
- передачу части конфигурации в клиентский код ([DefinePlugin](https://webpack.js.org/plugins/define-plugin/))
- предоставление клиентскому коду доступа к данным только выбранного МРФ ([NormalModuleReplacementPlugin](https://webpack.js.org/plugins/normal-module-replacement-plugin/))

Подробнее о конфигурировании в [документации webpack](https://webpack.js.org/configuration/)


__`webpack-helpers.js`__

Функции для генерации части конфигурации webpack


### `source`

Исходный код (логика работы приложения, компоненты, стили) обитает здесь

__`page-template.html`__

Шаблон HTML-документа, в который будет монтироваться приложение (в качестве содрежимого `div` с id `app-mountpoint`)


__`main.js`__

Отвечает за создание Vue инстанса, его монтирование и подключение роутинга


__`config.js`__

Включает частичную информацию о конфигурации сборки (маршрут по умолчанию, поддержка навигации между МРФ, выбранный МРФ)


__`router.js`__

Создаёт инстанс [vue-router](https://router.vuejs.org/), включает описание доступных для навигации машрутов


#### `util`

Вспомогательные средства, не относящиеся к конкретному компоненту/страницу


#### `style`

Описание общих стилей, установка констант (цветовая палитра, используемые шрифты, используемые в компонентах цвета)


#### `page`

Компоненты страниц (Контакты, Главная, Инфосистемы и пр.)


#### `components`

Компоненты, используемые для построения страниц (разделены по соответствующим каталогам), элементы пользовательского интерфейса

__`app.vue`__

Компонент-шаблон страниц


### `asset`

__`font`__

Шрифты


__`image`__

Изображения


#### `config`

Используемые страницами данные (разбиты по каталогам по регионам):

- шаблоны форм и описание элементов ввода параметров форм
- логины/пароли для страницы конфигуратора
- ссылки на инфосситемы


## Процесс сборки

### Просто

1. Скрипт из `package.json` вызывает [`build.js`](#корень), указывая под какие МРФ осуществляется сборка
2. [`build.js`](#корень) для каждого выбранного МРФ вызвает webpack, передавая МРФ через [`--env`](https://webpack.js.org/api/cli/#environment-options)
3. webpack препроцессирует `source/config.js`, предоставляя конфигурацию для сборки под выбранный МРФ
4. webpack препроцессирует импортируемые страницами файлы из `asset/config`, оставляя в клиентском коде только сведения относящиеся к выбранному МРФ
5. объединяет JS-модули в один файл, отдельно извлекает стили в CSS-файл и помещает их с сгенерированным `index.html` в `build/<выбранный МРФ>`


### Не просто

__TODO__ super как отдельный МРФ

__TODO__ структура файлов в конфиге и их подмена

__TODO__ алиасы

__TODO__ build.js, варианты вызова



## TODO

подумать насчёт создания маршрутов от конфига (запрет ходить в другие МРФ) в routes.js 

слоты для элементов навигации/ссылок на инфосистемы

обобщение компонента формы

исправить стиль активной ссылки

сконфигурировать eslint
